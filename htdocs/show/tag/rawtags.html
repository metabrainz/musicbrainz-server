<%args>
	$entitytype
	$entityid
</%args>
<%perl>

	my $mb = $m->comp("/comp/dblogin");
    $m->comp("/comp/checkloggedin", 1, 1, undef, 1)
		or return;
	
	my $t = MusicBrainz::Server::Tag->new($mb->{DBH});
	my $rawtags = $t->GetRawTagsForEntity($entitytype, $entityid, $session{uid});

	my $result = {
		"entitytype" => $entitytype,
		"entityid" => $entityid,
		"tags" => $rawtags,
	};

	use JSON;
	use Encode;
	my $json = new JSON;
	$r->content_type("text/plain; charset=utf-8");
	$m->out(Encode::decode "utf-8", $json->utf8(0)->encode($result));

</%perl>
%# vi: set ts=4 sw=4 ft=mason :
